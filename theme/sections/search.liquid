<script></script>

{% comment %}
  {%- style -%}
    #predictive-search-results-groups-wrapper {
      flex-direction: column;
    }

    .predictive-search__result-group {
      flex: 0;
    }
    .predictive-search__loading-state {
      display: none;
    }
  {%- endstyle -%}
{% endcomment %}

<div
  x-data="
        {
            search: '',
            predictiveResult: '',
            loading: true,
    getSearchResults(e) {
      console.log(e.target.value);
      fetch(`/search/suggest?q=${e.target.value}&section_id=predictive-search`).then((response) => {
        if (!response.ok) {
          var error = new Error(response.status);
          this.close();
          throw error;
        }
        this.loading = false
        return response.text();
      }).then((text)=>{
        this.predictiveResult = text;

    });
    }
        }
  "
  class="w-full pb-16 pl-5 pr-5 lg:px-[96px] pt-[56px] lg:pb-[64px] bg-[#f5efe7] flex flex-col justify-center items-center relative"
>
  <form
    action="{{ routes.search_url }}"
    onsubmit="(e)=>e.preventDefault()"
    method="get"
    class="relative w-full"
  >
    <div class="relative max-w-[992px] w-full mx-auto border-[#dcd6ce] ">
      <div class="w-full border-b">
        <input
          x-on:input.change.debounce.300ms="getSearchResults($event)"
          placeholder="Search"
          x-model="search"
          name="q"
          class="w-full bg-inherit focus-visible:outline-none focus-visible:shadow-none py-3 pr-[4.5rem] pl-4 lg:pl-2 lg:pr-20 text-left appearance-none relative outline-none placeholder:text-current placeholder:opacity-60"
          value="{{ search.terms | escape }}"
        >
      </div>
      <button
        class="btn-search absolute none_border w-7 h-7 p-1 top-1/2 -translate-y-1/2 opacity-60 bg-none text-current lg:right-2 right-2"
        aria-label="Search..."
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="100%"
          height="100%"
          viewBox="0 0 19 18"
          fill="none"
          style="fill: none;"
        >
          <path d="M9.2665 16.2001C13.4639 16.2001 16.8665 12.7975 16.8665 8.60009C16.8665 4.40272 13.4639 1.00009 9.2665 1.00009C5.06914 1.00009 1.6665 4.40272 1.6665 8.60009C1.6665 12.7975 5.06914 16.2001 9.2665 16.2001Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M17.6669 16.9999L16.0669 15.3999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
      </button>
      <div
        x-show="search != ''"
        x-html="predictiveResult"
        class="w-full max-w-[992px] mx-auto pt-6 absolute top-[calc(50%+12px)] z-10"
      ></div>
    </div>
  </form>
</div>

{% schema %}
{
  "name": "Search",
  "enabled_on": {
    "templates": ["*"]
  },
  "settings": [],
  "blocks": [],
  "presets": [
    {
      "name": "Search"
    }
  ]
}
{% endschema %}
